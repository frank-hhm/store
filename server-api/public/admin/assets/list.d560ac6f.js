import{_ as G}from"./LayoutBody.7a794797.js";import{a4 as S,a7 as n,a6 as H,aM as I,aA as p,aj as L,ap as o,aq as l,aN as D,ak as B,aB as h,al as J,aY as P,as as N,ac as Q,aC as W,ah as X,ag as j,aT as z,aU as Z,at as V,bb as ee,bc as te,a9 as ae,b3 as le,b4 as se,b5 as oe,an as w,ao as U,ba as ne}from"./index.30624dae.js";import{c as ue,u as re,g as q,s as ie,a as ce,b as de,d as _e}from"./role.d373137b.js";const me={name:"systemRoleCreate"},ve=S({...me,emits:["success"],setup(K,{expose:g,emit:A}){const{proxy:r,proxy:{$utils:k}}=V(),$=A,F=n("create"),i=n(0),c=n(!1),m=n(),d=n({role_name:"",remarks:""}),v=H({role_name:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\uFF01"}]}),t=n(!1),_=()=>{!i.value||(t.value=!0,q({id:i.value}).then(e=>{d.value.role_name=e.data.role_name,d.value.remarks=e.data.remarks,t.value=!1}).catch(e=>{t.value=!1,k.errorMsg(e)}))},u=n(!1),y=()=>{var e;(e=r==null?void 0:r.$refs.createRef)==null||e.validate((a,f)=>{if(console.log(a),!a){if(u.value)return;u.value=!0;let s=null;F.value=="create"?s=ue(d.value):s=re(Object.assign({id:i.value},d.value)),s.then(b=>{k.successMsg(b.message),C(),$("success"),u.value=!1}).catch(b=>{k.errorMsg(b),u.value=!1})}})},x=(e=0)=>{e!=0?(F.value="update",i.value=e):F.value="create",N(()=>{_()}),c.value=!0},C=()=>{var e;return(e=r==null?void 0:r.$refs.createRef)==null||e.resetFields(),i.value=0,c.value=!1,!0};return g({open:x}),(e,a)=>{const f=Q,s=W,b=X,M=j,T=z,R=Z,Y=I("loading"),O=I("btn");return p(),L("div",null,[o(R,{title:F.value=="create"?"\u6DFB\u52A0\u89D2\u8272":"\u7F16\u8F91\u89D2\u8272",onBeforeOk:y,onBeforeCancel:C,width:"400px",top:J(P)().ModalTop,class:"modal",visible:c.value,"onUpdate:visible":a[2]||(a[2]=E=>c.value=E),"align-center":!1,"title-align":"start","render-to-body":""},{footer:l(()=>[o(T,null,{default:l(()=>[D((p(),B(M,{onClick:C},{default:l(()=>[h("\u53D6\u6D88")]),_:1})),[[O]]),D((p(),B(M,{type:"primary",loading:u.value,onClick:y},{default:l(()=>[h("\u786E\u5B9A")]),_:1},8,["loading"])),[[O]])]),_:1})]),default:l(()=>[D((p(),B(b,{layout:"vertical",model:d.value,ref_key:"createRef",ref:m,rules:v},{default:l(()=>[o(s,{label:"\u89D2\u8272\u540D\u79F0\uFF1A",field:"role_name"},{default:l(()=>[o(f,{modelValue:d.value.role_name,"onUpdate:modelValue":a[0]||(a[0]=E=>d.value.role_name=E),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),o(s,{label:"\u5907\u6CE8\uFF1A",field:"remarks"},{default:l(()=>[o(f,{modelValue:d.value.remarks,"onUpdate:modelValue":a[1]||(a[1]=E=>d.value.remarks=E),placeholder:"\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[Y,t.value]])]),_:1},8,["title","top","visible"])])}}});const fe={name:"systemRoleAuth"},pe=S({...fe,emits:["success"],setup(K,{expose:g,emit:A}){const{proxy:r,proxy:{$utils:k}}=V(),$=A,F=n(),i=n([]),c=n(!0),m=n([]),d=()=>{c.value=!0,ce().then(e=>{i.value=e.data,N(()=>{var a;(a=r==null?void 0:r.$refs.treeRef)==null||a.expandAll()})}).catch(e=>{}),q({id:u.value}).then(e=>{m.value=v(e.data.rules),console.log(m.value),console.log(e.data.rules),c.value=!1}).catch(e=>{k.errorMsg(e)})},v=e=>{let a=[];return e.forEach(f=>{a.push(Number(f))}),a},t=n(!1),_=()=>{t.value||(t.value=!0,ie({id:u.value,rules:m.value}).then(e=>{k.successMsg(e.message),$("success"),t.value=!1,C()}).catch(e=>{k.errorMsg(e),t.value=!1}))},u=n(0),y=n(!1),x=(e=0)=>{u.value=e,N(()=>{d()}),y.value=!0},C=()=>{u.value=0,m.value=[],y.value=!1};return g({open:x}),(e,a)=>{const f=ee,s=j,b=z,M=te,T=I("loading");return p(),L("div",null,[o(M,{class:"drawer-default",title:"\u6388\u6743\u8BBE\u7F6E",visible:y.value,"onUpdate:visible":a[3]||(a[3]=R=>y.value=R),width:500},{default:l(()=>[D((p(),L("div",null,[o(f,{data:i.value,ref_key:"treeRef",ref:F,checkable:!0,"selected-keys":m.value,"onUpdate:selectedKeys":a[0]||(a[0]=R=>m.value=R),"checked-keys":m.value,"onUpdate:checkedKeys":a[1]||(a[1]=R=>m.value=R),"check-strictly":!0,fieldNames:{key:"id",title:"label",children:"children"},multiple:""},null,8,["data","selected-keys","checked-keys"])])),[[T,c.value]])]),footer:l(()=>[o(b,null,{default:l(()=>[o(s,{onClick:C},{default:l(()=>[h("\u53D6\u6D88")]),_:1}),o(s,{onClick:a[2]||(a[2]=R=>_()),type:"primary",loading:t.value,disabled:t.value},{default:l(()=>[h("\u786E\u5B9A")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["visible"])])}}}),ge={class:"text-grey"},ke={class:"text-grey"},Ce=S({__name:"list",setup(K){const{proxy:g}=V(),{proxy:{$utils:A}}=V(),r=n(!0),k=n([]),$=n(),F=v=>{g==null||g.$refs.createComponentRef.open(v)},i=n({total:0,limit:P().PageLimit.value,page:1}),c=(v=!1)=>{v&&(i.value.page=1),r.value=!0;let t={};t.page=i.value.page,t.limit=i.value.limit,de(t).then(_=>{k.value=_.data.data,i.value.total=_.data.total,setTimeout(()=>{r.value=!1},300)}).catch(_=>{A.errorMsg(_)})},m=v=>{_e({id:v}).then(t=>{c(),A.successMsg(t.message)}).catch(t=>{A.errorMsg(t)})},d=v=>{g==null||g.$refs.systemRoleAuthRef.open(v)};return ae(()=>{c()}),(v,t)=>{const _=j,u=ne,y=le,x=se,C=z,e=oe,a=G,f=I("permission");return p(),B(a,null,{default:l(()=>[w("div",null,[D((p(),B(_,{type:"primary",onClick:t[0]||(t[0]=s=>F(0))},{default:l(()=>[h(" \u6DFB\u52A0\u89D2\u8272 ")]),_:1})),[[f,"system-role-create"]])]),o(ve,{ref_key:"createComponentRef",ref:$,onSuccess:t[1]||(t[1]=s=>c(!0))},null,512),o(pe,{ref:"systemRoleAuthRef",onSuccess:t[2]||(t[2]=s=>c(!0))},null,512),o(e,{loading:r.value,class:"mt20",data:k.value,"row-key":"id",isLeaf:"",pagination:!1},{columns:l(()=>[o(u,{title:"\u89D2\u8272\u540D\u79F0","data-index":"role_name"},{cell:l(({record:s})=>[w("span",null,U(s.role_name),1)]),_:1}),o(u,{title:"\u5907\u6CE8","data-index":"remarks"},{cell:l(({record:s})=>[w("span",ge,U(s.remarks),1)]),_:1}),o(u,{title:"\u521B\u5EFA\u65F6\u95F4","data-index":"create_time",width:160},{cell:l(({record:s})=>[w("span",ke,U(s.create_time),1)]),_:1}),o(u,{title:"\u64CD\u4F5C",align:"center",width:140},{cell:l(({record:s})=>[o(C,null,{default:l(()=>[D((p(),B(_,{onClick:b=>d(s.id),size:"small"},{default:l(()=>[h("\u6388\u6743\u8BBE\u7F6E")]),_:2},1032,["onClick"])),[[f,"system-role-auth"]]),D((p(),B(_,{onClick:b=>F(s.id),size:"small"},{default:l(()=>[h("\u7F16\u8F91")]),_:2},1032,["onClick"])),[[f,"system-role-update"]]),D((p(),L("div",null,[o(x,{content:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onConfirm:b=>m(s.id)},{icon:l(()=>[o(y,{type:"red"})]),default:l(()=>[o(_,{size:"small"},{default:l(()=>[h("\u5220\u9664")]),_:1})]),_:2},1032,["onConfirm"])])),[[f,"system-role-delete"]])]),_:2},1024)]),_:1})]),_:1},8,["loading","data"])]),_:1})}}});export{Ce as default};
